<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View People</title>
    <link rel="stylesheet" href="homePage.css">
    <link rel="stylesheet" type="text/css" href="datatables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<body>
    <header>
        <div class="navbar">
            <a href="homepage"><i class="fa fa-fw fa-home"></i> Home</a> 
            <a class="active"><i class="fa fa-fw fa-user"></i> Create/View Team</a>
            <a href="examiners"><i class="fa fa-fw fa-search"></i> Create/View Examiners</a> 
            <a onclick = "logout()" style="float: right;"><i class="fa fa-fw fa-home"></i>Logout</a> 
          </div>
     </header>

     <div class="createTeamDiv" style="display: flex;">
     <div class="form-area">
         <!-- <form> -->
          <input type="text" id="tname" name="teamName" placeholder="Enter the Team Name.." required>
      
          <div style="display:flex">
          <input type="text" id="s1Name" name="s1Name" placeholder="Enter Student 1 name.." required>
          <button class="w3-button w3-small w3-circle w3-ripple w3-green button-add" onclick="add('studentTwo')">+</button>
           </div>

           <div class="studentTwo">
            <input type="text" id="s2Name" name="s2Name" placeholder="Enter Student 2 name.." required>
            <button class="w3-button w3-small w3-circle w3-ripple w3-green button-add" onclick="add('studentThree')">+</button>
            <button class="w3-button w3-small w3-circle w3-ripple w3-red button-minus" onclick="remove('studentTwo')">-</button>
             </div>

             <div class="studentThree">
                <input type="text" id="s3Name" name="s3Name" placeholder="Enter Student 3 name.." required>
                <button class="w3-button w3-small w3-circle w3-ripple w3-green button-add" onclick="add('studentFour')">+</button>
                <button class="w3-button w3-small w3-circle w3-ripple w3-red button-minus" onclick="remove('studentThree')">-</button>
                 </div>

                 <div class="studentFour">
                    <input type="text" id="s4Name" name="s4Name" placeholder="Enter Student 4 name.." required>
                    <button class="w3-button w3-small w3-circle w3-ripple w3-red button-minus" onclick="remove('studentFour')">-</button>

                     </div>
        

          <input type="submit" value="Create New Team" onclick="createTeam()">
        <!-- </form> -->
      </div>

     <div class="table_area">
        <table id="table" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <th>Team Name</th>
                <th>Team Members</th>
            </thead>
    </table>
</div>
    </div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>

    <script>
    $(document).ready( function () {

        checkValidToken().then(function(res){
            console.log(res.data);
            var jsonData = res.data;

         var dt = $('#table').DataTable({
                "scrollY": "400px",
                 "scrollCollapse": true,
                "processing": true,
                "data": jsonData,
                "columns": [
             
                { "data": "name",
                "class":  "border_class", },
                { "data": "members" }
            ],
            "columnDefs": [
    {"className": "dt-center", "targets": "_all"}
  ]
        });

       
    }).catch(function(err){
        console.log(err);
        alert("Session expired. Please login again!!");
        window.location = '/index.html';
    });


//     $('.add').on('click', add);
// $('.remove').on('click', remove);


});

    function checkValidToken(){
        const config = {
            headers: { Authorization: 'Bearer '+window.localStorage.token}
        };
        return axios.get('http://64.227.27.167:3000/api/v1/admin/teams' , config);
    }

    function add(fieldValue) {
        $('.'+fieldValue).val('');
        $('.'+fieldValue).css('display','flex');
    }

    function remove(fieldValue) {
        $('.'+fieldValue).val('');
        $('.'+fieldValue).css('display','none');
    }

    function createTeam(){
        
        var teamName = $('#tname').val();
        var stu1 = $('#s1Name').val();
        var stu2 = $('#s2Name').val();
        var stu3 = $('#s3Name').val();
        var stu4 = $('#s4Name').val();

        if(stu2 != undefined && stu2 != ''){
            stu1 += ', '+stu2;
        }else if(stu3 != undefined && stu3 != ''){
            stu1 += ', '+stu3;
        }else if(stu4 != undefined && stu4 != ''){
            stu1 += ', '+stu4;
        }

        const config = {
            headers: { Authorization: 'Bearer '+window.localStorage.token},
            
        };

        const data = {
                "name": teamName,
                "members": stu1
            };
        axios.post('http://64.227.27.167:3000/api/v1/admin/teams' , data, config 
        ).then(function(res){
            // console.log("hey it is working")
             $('#tname').val('');
             $('#s1Name').val('');
             $('#s2Name').val('');
             $('#s3Name').val('');
             $('#s4Name').val('');
            alert("Team Successfully Created");
            checkValidToken().then(function(res){
            console.log(res.data);
            var jsonData = res.data;

            $("#table").dataTable().fnDestroy()

         var dt = $('#table').DataTable({
                "processing": true,
                "data": jsonData,
                "columns": [
             
                { "data": "name" },
                { "data": "members" }
            ],
            "columnDefs": [
    {"className": "dt-center", "targets": "_all"}
  ]
        });

       
    }).catch(function(err){
        console.log(err);
        alert("Session expired. Please login again!!");
        window.location = './';
    });
        }).catch(function(err){
            console.log(err);
        });
    }

    function logout(){
        window.localStorage.clear();
        // alert("Logged out successfully!");
        window.location = "./";
    }

    </script>
</body>
</html>