<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <div class="login">
        <h1>Login</h1>
        <!-- <form action="#0"> -->
            <input type="text" id="username" name="u" placeholder="Username" required="required" />
            <input type="password" id="password" name="p" placeholder="Password" required="required" />
            <button type="submit" class="btn btn-primary btn-block btn-large" onclick="checkCredentials()">Login</button>
        <!-- </form> -->
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
    <script>

        $(document).ready( function () {
            if(window.localStorage.token != undefined){
                const config = {
                     headers: { Authorization: 'Bearer '+window.localStorage.token}
                };
                axios.get('http://64.227.27.167:3000/api/v1/admin/teams' , config).then(function(res){
                    window.location = '/homepage';
                }).catch(function(err){
                    console.log(err);
                    console.log("Session is expired..")
                })
            }
        });        

        function checkCredentials(){
            // if(validateCredentials()){
                console.log("It is coming inside the function");
                axios.get('http://64.227.27.167:3000/api/v1/users/login?' , {
                auth: {
                    username: 'john@gmail.com',
                    password: 'admin123'
                }
                }).then(function(res){
                    console.log(res.data);
                    window.localStorage.setItem('token', res.data.token)
                    window.location = '/homepage';
                }).catch(err => {
                    console.log("It is coming here");
                    alert("Invalid credentials!")
                });
            // }
        }

        function validateCredentials(){
            var username = $('#username').val();
            var password = $('#password').val();

            if(username === ""){
                var element = document.getElementById("username");
                console.log("hello");
                element.setCustomValidity('Please enter the username');
            }else if(password === ""){
                var element = document.getElementById("password");
                element.setCustomValidity('Please enter the password');
            }else{
                return true;
            }
            return false; 
        }

    </script>


</body>
</html>